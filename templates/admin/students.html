{% extends "base.html" %}

{% block title %}Student Records - CCICT Helpdesk{% endblock %}

{% block content %}
{% include 'sidebar.html' %}

<main class="main-content">
  <div class="page-header">
    <h1>Student Records</h1>
    <p>View full student information (Admin access - phone numbers visible)</p>
  </div>

  {% if message %}
  <div class="alert alert-{{ message_type }}">
    {{ message }}
  </div>
  {% endif %}

  <div style="margin-bottom: 2rem;">
    <button class="btn btn-primary" onclick="openModal()">
      <i class="fas fa-plus"></i> Add Student
    </button>
  </div>

  <!-- Modal -->
  <div id="addStudentModal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h2>Add New Student</h2>
        <span class="close" onclick="closeModal()">&times;</span>
      </div>
      <form method="POST" action="{{ url_for('add_student') }}">
        <div class="modal-body">
          <div class="form-group">
            <label for="name">Name *</label>
            <input type="text" id="name" name="name" required>
          </div>
          <div class="form-group">
            <label for="email">Email *</label>
            <input type="email" id="email" name="email" required>
          </div>
          <div class="form-group">
            <label for="phone">Phone Number</label>
            <input type="text" id="phone" name="phone" placeholder="Optional">
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" onclick="closeModal()">Cancel</button>
          <button type="submit" class="btn btn-primary">Add Student</button>
        </div>
      </form>
    </div>
  </div>

  <div class="table-container">
    {% if students %}
    <table>
      <thead>
        <tr>
          <th>Student ID</th>
          <th>Name</th>
          <th>Email</th>
          <th>Phone Number</th>
        </tr>
      </thead>
      <tbody>
        {% for student in students %}
        <tr>
          <td><strong>#{{ student[0] }}</strong></td>
          <td>{{ student[1] }}</td>
          <td>{{ student[2] }}</td>
          <td>{{ student[3] if student[3] else 'N/A' }}</td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
    {% else %}
    <div class="empty-state">
      <i class="fas fa-users"></i>
      <h3>No Students Found</h3>
      <p>There are currently no students in the system.</p>
    </div>
    {% endif %}
  </div>

  <script>
    function openModal() {
      document.getElementById('addStudentModal').style.display = 'block';
    }

    function closeModal() {
      document.getElementById('addStudentModal').style.display = 'none';
    }

    // Close modal when clicking outside of it
    window.onclick = function(event) {
      const modal = document.getElementById('addStudentModal');
      if (event.target == modal) {
        closeModal();
      }
    }

    // Close modal with Escape key
    document.addEventListener('keydown', function(event) {
      if (event.key === 'Escape') {
        closeModal();
      }
    });
  </script>
</main>
{% endblock %}
